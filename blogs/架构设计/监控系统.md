# 目标

- 实时性
- 全面性
  - 异常监控 js promise reject
  - 性能指标 自定义指标
  - 用户行为
  - 网络请求
- 易用性
  - 快速定位
  - 数据分析全面便捷
- 低侵入性

# 架构设计

整体分为数据采集、数据传输、数据处理和存储、数据展示

## 数据采集范围

- 异常监控
  - 捕获运行时错误：window.onerror
  - 捕获未捕获的 Promise 异常：window.onunhandledrejection
  - 捕获资源加载错误：window.addEventListener('error', ...)
  - 自定义错误上报（如埋点异常）
- 性能监控
  - Performance API
  - 自定义指标，如登录成功率、自定义渲染时间
  - 资源性能
  - 网络请求拦截
- 用户行为
- 设备信息
- 网络环境

## 数据传输

技术实现: 使用 Beacon API 实现无阻塞上传

- 实时
- 批量延迟
- 降级策略，断网时
- 安全传输

## 数据处理

- 错误分级
  - error
    - L0 L1 L2
  - waring
  - info
- 不同级别对应不同处理方案
  - 比如必须在规定时间内处理
  - 多久不处理会升级
  - 可以接受、忽略等
  - 自动发送 @相关人员

## 数据展示

- 全局视图
- 异常分析
- 性能分析
- 用户行为回放、行为轨迹
- 报警面板

对比手段

- 分层（维度）
  - 地区、设备、网络情况
- 对比基准
  - 历史平均值
  - 不同周期内
  - 滑动时间窗口内
  - 环比数据 4 月和 3 月 3 月和 2 月
  - 同比数据 去年 3 月和今年 3 月
- 分组对比
- 热力图
